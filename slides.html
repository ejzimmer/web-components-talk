
<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="reveal/reveal.css">
    <link rel="stylesheet" href="shared.css" />
		<link rel="stylesheet" href="slides.css" />
		<link rel="stylesheet" href="zenburn.css" />

		<script src="reveal/reveal.js"></script>

		<script>
			const isNextSlide = key => key === 'PageDown' || key === 'ArrowRight' || key === ' ';
			function doOnKeyPress(...callbacks) {
				function listener(event) {
					if (isNextSlide(event.key)) {
						event.stopPropagation();
						callbacks[0]();
						document.body.removeEventListener('keydown', listener);

						if (callbacks.length > 1) {
							callbacks = callbacks.slice(1);
							doOnKeyPress(...callbacks);
						}
					}
				}
				document.body.addEventListener('keydown', listener);
			}
			function doOnKeyPresses(callback, times) {
				const callbacks = [];
				for (let i = 0; i < times; i++) {
					callbacks.push(callback);
				}
				doOnKeyPress(...callbacks);
			}

			function highlightSummaryList(listSelector) {
				document.querySelectorAll(`${listSelector} li:not(.highlighted)`).forEach(li => li.classList.add('dimmed'));
			}

			function highlightLineInBlock(block, n) {
				document.querySelectorAll(`${block} > span`).forEach(line => line.classList.add('dimmed'));
				document.querySelector(`${block} > span:nth-child(${n})`).classList.remove('dimmed');
			}
		</script>						
			
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
	      <section>
					<div class="centred">
						<h1>Web Components</h1>
						<div class="subtitle">It's about time.</div>		
					</div>
				</section>
				<section data-background-image="images/Steven_Universe_title.jpg">
				</section>
				<section>
					<div style="display: flex; justify-content: space-evenly; width: 100%">
						<figure style="display: flex; flex-direction: column; align-items: center">
						<img src="images/web-components-logo.png" style="width: 100%" />
						<figcaption style="font-size: .9em; font-family: sans-serif">
							WEB COMPONENTS
						</figcaption>
					</figure>
					<div style="width: 40%">
						<div class="notes">Allow you to create new HTML elements that are</div>
						<ul>
							<li class="fragment">Custom</li>
							<li class="fragment">Reusable</li>
							<li class="fragment">Encapsulated</li>
						</ul>
					</div>
					</div>
				</section>
				<section>
					<div class="specs-grid">
						<div class="html-template"></div>
						<div class="custom-element"></div>
						<div class="shadow-dom"></div>
						<div class="html-import"></div>
					</div>
					<img src="images/Alexandrite.png" class="fragment" style="position: fixed; top: 0; left: 20%" />
				</section>
				<section>
					<div class="notes">
						Back in 2011, Alex Russell presented a proposal for web components (and some other stuff)
						at Fronteers in Holland. You can watch it here, if you want. 
						Talks about reasons for web components
						It's... long.
						And, really, the proposal didn't get much traction when it was first presented.
					</div>
					<img src="images/proposal-video.png" class="border" style="margin-bottom: 1em; width: 100%" />
					<a style="font-size: .7em; font-family: Arial; position: relative; transform: scale(.9); color: var(--yellow); bottom: 3.5em" 
						class="fragment"
						href="https://fronteers.nl/congres/2011/sessions/web-components-and-model-driven-views-alex-russell">
						https://fronteers.nl/congres/2011/sessions/web-components-and-model-driven-views-alex-russell
					</a>
				</section>
				<section class="framework-logos">
					<img src="images/angular-logo.png" />
					<img src="images/react-logo.png" />
					<img src="images/vue-logo.png" />
					<div class="notes">
						Some important things have changed since 2011
						Everything is components now
					</div>
					<div class="notes">
						Web components aren't really a replacement for your framework components
						There are still a couple of things that frameworks do better
					</div> 
				</section>
				<section>
					 <pre style="font-size: 1.5em"><code class="xml"><div>Hello, {{ name }}</div></code></pre>
					 <div class="notes">
							Interpolation (with a differing number of curly braces depending on which framework you're using)
						</div>
				 </section>
				<section>
					 <pre style="font-size: .8em"><code class="javascript">document.querySelector('#hello').textContent = `Hello, ${name}`</code></pre>
					 <div class="notes">
						 You can do it with web components, it's just a bit more involved, and you have to write a bit of JavaScript.
					 </div>
				</section>
				<section>
					<pre style="font-size: 2em"><code>render()</code></pre>
					<div class="notes">
						You're also not going to get the automatic change detection you do in Angular & Vue,
						or even the manual DOM updating that you get in React. You're basically going to need
						to write your own render() function.
					</div>
				</section>
				<section>
					<pre><code class="xml">&lt;MyAwesomeComponent config="configOptions" /&gt;</code></pre>
					<div class="notes">
						You also can't pass objects in as attributes like you could with a framework component
						You can only pass strings
					</div>
				</section>
				<section data-state="framework-or-web-component">
<pre class="should-i-web-component">
 <span class="framework highlight-0">&lt;app-root&gt;</span>
  <span class="framework highlight-1">&lt;container-component&gt;</span>
   <span class="framework highlight-2">&lt;presentation-component&gt;</span>
    <span class="web-component highlight-3">&lt;div&gt;</span>
     <span class="web-component highlight-3">&lt;label&gt;&lt;/label&gt;</span>
     <span class="web-component highlight-3">&lt;input /&gt;</span>
    <span class="web-component highlight-3">&lt;/div&gt;</span>
   <span class="framework highlight-2">&lt;/presentation-component&gt;</span>
   <span class="web-component-maybe highlight-2">&lt;presentation-component&gt;</span>
   <span class="web-component-maybe highlight-2">&lt;/presentation-component&gt;</span>
  <span class="framework highlight-1">&lt;/container-component&gt;</span>
 <span class="framework highlight-0">&lt;/app-root&gt;</span>
</pre>
					<script>
						Reveal.addEventListener('framework-or-web-component', () => {
							let index = 0;

							function removeHighlighting() {
								document.querySelectorAll('.should-i-web-component span')
									.forEach(element => element.classList.remove('dimmed'));
							}

							function highlightNext() {
								removeHighlighting();
								document.querySelectorAll(`.should-i-web-component span:not(.highlight-${index++})`)
									.forEach(element => element.classList.add('dimmed'));
							}

							function changeColour(selector, colour) {
								document.querySelectorAll(`.should-i-web-component ${selector}`)
											.forEach(element => element.style.color = `var(--${colour})`)
							}

							function listener(event) {
								if (isNextSlide(event.key)) {
									event.stopPropagation();

									if (index < 4) {
										highlightNext();
									}

									else if (index === 4) {
										removeHighlighting();
										changeColour('.web-component', 'yellow');
										index++;
									}

									else if (index === 5) {
										changeColour('.web-component-maybe', 'yellow');
										index++;
									}

									else if (index == 6) {
										changeColour('.framework', 'red');
										index++;
									}

									if (index > 6) {
										document.body.removeEventListener('keydown', listener);
									}
								}
							}

							document.body.addEventListener('keydown', listener);

						});
					</script>
				</section>
				<section data-background-image="images/Big_Donut.png">
					<a class="card" href="big-donut.html" target="blank">Big Demo</a>
				</section>
				<section>
					<h2>HTML Templates</h2>
					<img src="images/templates.svg" style="width: 40vw" />
				</section>
				<section>
					<div style="display: flex; align-items: center">
						<ol>
							<li>Create a reusable template using <code>&lt;template&gt;&lt;/template&gt;</code></li>
							<li>Clone the template</li>
							<li>Attach the clone to the DOM</li>
						</ol>
						<img src="images/holo-pearl.jpg" style="width: 50%" />
					</div>
				</section>
				<section>
					<pre><code class="xml"><template id="buy-template">
 <div class="buy">
  <label>
    <span>How many?</span>
    <input type="number" />
  </label>
  <button>Buy</button>
 </div>
</template></code></pre>
				</section>
				<section data-background-image="images/pearl-to-action.jpg">
					<div class="card light">Demo!</div>
				</section>
				<section>
					<img src="images/caniuse-templates.png" class="border" />
					<div class="notes">
						explanation of IE and opera mini
					</div>
				</section>
				<section data-state="template-summary">
					<div style="display: flex;">
						<ul id="template-summary" class="clear-list" style="margin: auto; font-size: 2em">
							<li>Custom</li>
							<li class="highlighted">Reusable</li>
							<li>Encapsulated</li>
						</ul>
					</div>
					<script>
						Reveal.addEventListener('template-summary', () => {
							doOnKeyPress(highlightSummaryList.bind(undefined, '#template-summary'));
						});
					</script>
				</section>
				<section>
					<div style="display: flex; width: 100%">
						<img style="flex-grow: 2" src="images/shadow-dom.svg" />
						<img src="images/GarnetByKmes.png" />
					</div>
				</section>
				<section data-state="ruby-sapphire-fusion">
						<div class="alert">Spoiler Alert!</div>
						<div id="ruby-sapphire-fusion" class="bottom-up-images down">
							<img class="ruby" src="images/ruby.png" />
							<img class="sapphire" src="images/sapphire.png" />
							<img class="garnet hidden" src="images/GarnetByKmes.png" style="margin: auto" />
						</div>
						<div class="notes">
							Spoiler alert for the last episode of season 1
							Garnet demonstrates shadow DOM because she's actually a gem fusion
							She's made up inside of two gems, with different abilities, but presents
							a single, unified API to the outside world
							And that's how shadow DOM works! Kind of.
						</div>
						<script>
							Reveal.addEventListener('ruby-sapphire-fusion', () => {
								function showRubyAndSapphire() {
									document.getElementById('ruby-sapphire-fusion').classList.remove('down');
								}
								function fuseRubyAndSapphire() {
									document.querySelectorAll('#ruby-sapphire-fusion img').forEach(gem => gem.classList.add('fused'));
									document.body.addEventListener('transitionend', () => {
										document.querySelectorAll('#ruby-sapphire-fusion img').forEach(gem => gem.classList.add('hidden'));
										const garnet = document.querySelector('#ruby-sapphire-fusion .garnet');
										requestAnimationFrame(() => {
											garnet.classList.remove('hidden');
											requestAnimationFrame(() => {
												garnet.style.transform = 'scale(1.5)';
											});
										});
									}, { once: true });
								}
								doOnKeyPress(showRubyAndSapphire, fuseRubyAndSapphire);
							});
						</script>
	      </section>
	      <section>
					<div>
						<select class="hover-highlight">
							<option>Steven</option>
							<option>Connie</option>
							<option>Peridot</option>
							<option>Pink Diamond</option>
						</select>
						<input type="file" class="hover-highlight" style="transform: scale(2.5); margin: 50px" />					
					</div>
					<video controls class="abc-tv hover-highlight" style="transform: scale(2); margin: 100px;"></video> 
					<div class="notes">
						Actually, you're probably already familiar with shadow DOM
						Each of these elements is obviously made up of a bunch of different parts,
						but they appear as a single element to the developer
						(Exception: select, but even then the options elements are clearly each made up of
						multiple bits which appear as a single element to the user)
						They are - essentially - a bit of DOM that is hidden from the main DOM
						New Shadow DOM spec = you can now build elements like this.
					</div>
				</section>
				<section>
<pre style="width: 600px; margin-bottom: 0;" class="fragment"><code><div id="outer"></div></code></pre>
<pre style="width: 600px;" class="fragment"><code>#outer {
 width: 200px;
 height: 200px;
 background-color: var(--yellow);
 display: flex;
}</code></pre>
				</section>
				<section>
					<div id="outer"></div>
				</section>
				<section data-state="create-shadow">
					<pre><code data-noescape class="create-shadow"><span>const inner = document.createElement('div');</span>
<span>inner.style.width = '100px';
inner.style.height = '100px';
inner.style.border = '4px solid var(--red)';
inner.style.margin = 'auto';</span>

<span>const outer = document.getElementById('outer');</span>
<span>const shadow = outer.attachShadow({ mode: 'open' });</span>
<span>outer.appendChild(inner);</span>
</code></pre>
					<script>
						Reveal.addEventListener('create-shadow', () => {
							let n = 0;
							const blockSelector = 'code.create-shadow';
							function highlightLine() { highlightLineInBlock(blockSelector, ++n); }
							doOnKeyPresses(highlightLine, 5);
						});
					</script>
				</section>
				<section class="box-in-box">
					<div id="outer"></div>
					<script>
						const inner = document.createElement('div');
						inner.style.width = '100px';
						inner.style.height = '100px';
						inner.style.border = '4px solid var(--red)';
						inner.style.margin = 'auto';

						const outer = document.querySelector('.box-in-box #outer');
						const shadow = outer.attachShadow({ mode: 'open' });
						shadow.appendChild(inner);						
					</script>
						<div class="notes">
							- show CSS can't touch it
							- this is a little bit different from some browser native shadow elements, as CSS can touch them a bit
							- can access via JS and change styles (use background-color)
							- change to closed, show can't access via JS
						</div>
				</section>
				<section>
					<img src="images/caniuse-shadow-dom.png" class="border" />
					<div class="notes">
						- Shadow DOM v0, vs v1
						- Under consideration for Edge
						- Safari has minor bugs
					</div>
				</section>
				<section data-state="shadow-dom-summary">
					<div style="display: flex;">
						<ul id="shadow-dom-summary" class="clear-list" style="margin: auto; font-size: 2em">
							<li>Custom</li>
							<li>Reusable</li>
							<li class="highlighted">Encapsulated</li>
						</ul>
					</div>
					<script>
						Reveal.addEventListener('shadow-dom-summary', () => {
							doOnKeyPress(highlightSummaryList.bind(undefined, '#shadow-dom-summary'));
						});
					</script>
					<div class="notes">
						This is cool and all, but where things start getting much more interesting is when
						we combine the two specs we've looked at already
					</div>
				</section>
				<section>
					<div class="spec-pics">
						<img src="images/templates.svg" />
						<img src="images/shadow-dom.svg" />
					</div>
					<img style="position: fixed; right: -100px; bottom: 0;" src="images/Sardonyx_by_Lenhi.png" class="fragment" />
				</section>
				<section>
					<h2 style="font-size: 4em">Slots</h2>
					<div class="notes">
							Slots are shadow DOM that we can pass bits of light DOM into
							Like select elements - pass in options
						</div>	
				</section>
				<section>
					<select>
						<option>Steven</option>
						<option>Connie</option>
						<option>Peridot</option>
						<option>Pink Diamond</option>
					</select>	
					<pre><code><select>
 <option>Steven</option>
 <option>Connie</option>
 <option>Peridot</option>
 <option>Pink Diamond</option>
</select></code></pre>	
					<div class="notes">
						Even though we can't affect the inner DOM of the select very much at all
						(can't even add padding!), we can still pass it these options elements
						Slots work a lot like this.
					</div>
				</section>
				<section>
					<div style="width: 650px; display: flex; flex-direction: column;">
						<pre class="fragment" style="margin-top: 0;"><code><template>
  <div>Hello, <slot></slot></div>
</template></code></pre>
					<pre class="fragment"><code class="xml"><div class="greeting">
  <span style="color: var(--yellow)">
   World
  </span>
</div></code></pre>
					<template id="greeting-template">
						<div>Hello, <slot></slot></div>
					</template>
					<div id="greeting" class="fragment" style="margin-top: 50px">
						<span style="color: var(--yellow)">World</span>
					</div>
					<script>
						const greetingTemplate = document.getElementById('greeting-template').content;
						const greeting = document.getElementById('greeting');
						const greetingShadowRoot = greeting.attachShadow({ mode: 'open' });
						greetingShadowRoot.appendChild(greetingTemplate.cloneNode(true));
					</script>
				</section>
				<section data-background-image="images/sardonyx-background.png">
					<div class="card light">Demo!</div>
					<div class="notes">
						If you remember back to our demo... (template.html)
						- Cleaned things up a lot
						- Still some repeated code: some structural code in the main HTML
						- Slots will allow us to move all structural code to template & just have content in the main HTML
					</div>
				</section>
				<section data-state="slots-demo">
					<pre><code class="xml slots-demo-code"><template id="item-template">
<div class="item">
 <div class="picture">
  <slot name="picture"></slot>
 </div>
 <h2><slot name="item-name"></slot></h2>
 <div class="description">
  <slot name="description"></slot>
 </div>
 <div class="buy">
  <label>
   <span>How many?</span>
   <input type="number" />
  </label>
  <button>Buy</button>
 </div>
</div>
</template></code></pre>
					<script>
						Reveal.addEventListener('slots-demo', () => {
							const linesToHighlight = [4, 8, 12];

							function highlightSlots() {
								document.querySelectorAll('.slots-demo-code, .slots-demo-code *').forEach(element => element.classList.add('dimmed'));
								linesToHighlight.forEach(lineNumber => {
									highlightChild(lineNumber);
									highlightChild(lineNumber + 1);
								});
							}
							function highlightChild(n) {
								const selector = `.slots-demo-code > .hljs-tag:nth-child(${n})`;
								document.querySelector(selector).classList.remove('dimmed');
								document.querySelectorAll(`${selector} *`).forEach(element => element.classList.remove('dimmed'));
							}

							doOnKeyPress(highlightSlots);
						});
					</script>
				</section>
				<section>
					<pre><code class="xml"><div class="item">
 <img slot="picture" src="images/donut.png" />
 <span slot="item-name">Donut</span>
 <span slot="description">
  Exactly what you'd expect at a donut shop
 </span>
</div></code></pre>
				</section>
				<section data-state="slots-summary">
					<div style="display: flex;">
						<ul id="slots-summary" class="clear-list" style="margin: auto; font-size: 2em">
							<li>Custom</li>
							<li class="highlighted">Reusable</li>
							<li class="highlighted">Encapsulated</li>
						</ul>
					</div>
					<script>
						Reveal.addEventListener('slots-summary', () => {
							doOnKeyPress(highlightSummaryList.bind(undefined, '#slots-summary'));
						});
					</script>
					<div class="notes">
						HTML just contains the content - the styling is abstracted away, just as it should be
						BUT requires JavaScript every time you want to add a new element to the page, which
						is not how anyone wants to write HTML
						What we really want to do is write...
					</div>
				</section>
				<section>
						<pre><code class="xml"><big-donut-item name="Donut" image="images/donut.png">
 Exactly what you'd expect at a donut shop
</big-donut-item></code></pre>
				</section>
				<section>
					<div style="display: flex; width: 100%">
						<img style="flex-grow: 2" src="images/custom-elements.svg" />
						<img src="images/amethyst.png" />
					</div>
					<div class="notes">
						The custom elements spec lets you extend HTML by creating your own elements
						Much like Angular/Vue/React
						Works pretty similar to React components
					</div>
				</section>
				<section data-state="create-custom-element-code">
					<pre><code class="js create-custom-element-code" style="width: 800px" data-noescape><span>class MyElement extends HTMLElement {</span>
 <span>constructor() {
  super();</span>
  <span>alert('custom element created');</span>
 }
}
<span>customElements.define('my-element', MyElement)</span></code></pre>
					<pre><code class="html" style="width: 800px"><my-element></my-element></code></pre>
					<script>
						Reveal.addEventListener('create-custom-element-code', () => {
							let n = 0;
							const blockSelector = 'code.create-custom-element-code';
							function highlightLine() { highlightLineInBlock(blockSelector, ++n); }
							doOnKeyPresses(highlightLine, 4);

							class MyElement extends HTMLElement {
								constructor() {
									super();
									alert('custom element created.');
								}
							}
							customElements.define('my-element', MyElement);
						});
					</script>
					<div class="notes">
						Must have a hyphen in the name
						So that's pretty useless - what we really want to do is put stuff inside our custom element
					</div>
				</section>
				<section>
					<pre><code class="js" style="width: 1000px">class ElementWithChild extends HTMLElement {
 constructor() {
  super();
  this.appendChild(document.createElement('div'));
 }
}
customElements.define('element-with-child', ElementWithChild);</code></pre>
					<pre><code class="html" style="width: 1000px"><illegal-element></illegal-element></code></pre><illegal-element></illegal-element>
				</section>
				<section>
					<div class="browser-error">Uncaught DOMException: Failed to construct 'CustomElement': The result must not have children</div>
					<div class="notes">
						So that's pretty unhelpful
						Luckily, we know a way to add stuff that is hidden from the DOM!
					</div>
				</section>
				<section>
					<div class="spec-pics">
						<img src="images/custom-elements.svg" />
						<img src="images/shadow-dom.svg" />
					</div>
					<img style="position: fixed; left: -200px; bottom: 0;" src="images/Sugilite.png" class="fragment" />
				</section>
				<section data-state="element-with-shadow">
					<pre><code class="javascript element-with-shadow-code" data-noescape>class ShadowElement extends HTMLElement {
 constructor() {
  super();
  const div = document.createElement('div');
  div.innerHTML = 'hello world';

  <span class="highlighted">const shadowRoot = this.attachShadow({ mode: 'open' });
  shadowRoot.appendChild(div);</span>
 }

 customElements.define('shadow-element', ShadowElement);
}</code></pre>
					<script>
						Reveal.addEventListener('element-with-shadow', () => {
							const block = 'code.element-with-shadow-code';
							doOnKeyPress(() => {
								document.querySelectorAll(`${block}, ${block} *`)
									.forEach(bitOfCode => bitOfCode.classList.add('dimmed'));
								document.querySelectorAll(`${block} .highlighted`)
									.forEach(bitOfCode => {
										bitOfCode.classList.remove('dimmed');
										bitOfCode.style.color = 'var(--blue)';
									});
								document.querySelectorAll(`${block} .highlighted *`)
									.forEach(bitOfCode => bitOfCode.classList.remove('dimmed'));
							});
						});
					</script>
				</section>
				<section>
					<pre><code class="html"><shadow-element></shadow-element></code></pre>
					<shadow-element class="fragment" style="margin-top: 100px"></shadow-element>
					<script>
						class ShadowElement extends HTMLElement {
							constructor() {
								super();
								const div = document.createElement('div');
								div.innerHTML = 'hello world';

								const shadowRoot = this.attachShadow({ mode: 'open' });
								shadowRoot.appendChild(div);
							}
						}
						customElements.define('shadow-element', ShadowElement);
					</script>
					<div class="notes">
						So that's cool, but now we're once again left with the problem of writing
						all our DOM in JavaScript - particularly annoying for CSS!
						If only there was a way...
					</div>
				</section>
				<section>
					<div class="spec-pics three">
						<img src="images/templates.svg" />
						<img src="images/shadow-dom.svg" />
						<img src="images/custom-elements.svg" />
					</div>
					<img style="position: fixed; left: 0; top: 0;" src="images/Alexandrite.png" class="fragment" />
				</section>
				<section>
					<pre><code><template id="example-template">
 <style>div { -webkit-text-stroke: var(--red) 2px }</style>
 <div>Hello, world!</div>
</template>

<script>
 class MyAwesomeElement extends HTMLElement {
  constructor() {
   super();

   const shadowRoot = this.attachShadow({ mode: 'open' });
   const template = document.getElementById('example-template')
   const content = template.content.cloneNode(true);

   shadowRoot.appendChild(content);
  }
 }
 customElements.define('my-awesome-element', MyAwesomeElement);
</script></code></pre>
				</section>
				<section>
					<pre><code class="html"><my-awesome-element></my-awesome-element></code></pre>
					<my-awesome-element class="fragment" style="margin-top: 100px; transform: scale(2)"></my-awesome-element>
				</section>
				<section data-background-image="images/alexandrite-demo.png">
					<div class="card light">Demo!</div>
				</section>
				<section>summary</section>
				<section>caniuse</section>
				<section>html imports</section>
      </div>
		</div>
		<script src="reveal/head.min.js"></script>
		<script>
			Reveal.initialize({
        controls: false,
        progress: false,
				history: true,
				center: false,
				display: 'flex',
				dependencies: [
					{ src: 'reveal/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
				]
			});
		</script>
  </body>
</html>
